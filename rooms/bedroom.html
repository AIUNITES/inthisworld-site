<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bedroom ‚Äî InThisWorld</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a0f;color:#e0e0f0;font-family:'Segoe UI',system-ui,sans-serif;overflow:hidden}
canvas{display:block;position:fixed;top:0;left:0}
.chat-panel{position:fixed;right:0;top:0;bottom:0;width:320px;background:rgba(10,10,25,0.92);border-left:1px solid rgba(99,102,241,0.2);z-index:20;display:flex;flex-direction:column;backdrop-filter:blur(8px)}
.chat-header{padding:14px 18px;border-bottom:1px solid rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:space-between}
.chat-header h3{font-size:1rem;color:#818cf8}
.chat-header .room-count{font-size:0.75rem;color:rgba(255,255,255,0.4);background:rgba(99,102,241,0.15);padding:3px 10px;border-radius:10px}
.chat-msgs{flex:1;overflow-y:auto;padding:12px 16px;display:flex;flex-direction:column;gap:8px;scrollbar-width:thin;scrollbar-color:rgba(99,102,241,0.3) transparent}
.chat-msg{padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.03);font-size:0.85rem;line-height:1.5;animation:msgIn 0.3s ease}
@keyframes msgIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.chat-msg .name{font-weight:700;font-size:0.8rem;margin-bottom:2px}
.chat-msg.system{background:rgba(99,102,241,0.08);color:#818cf8;font-style:italic;font-size:0.8rem}
.chat-input-wrap{padding:12px;border-top:1px solid rgba(255,255,255,0.06);display:flex;gap:8px}
.chat-input{flex:1;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:10px 14px;color:#fff;font-family:inherit;font-size:0.9rem;outline:none}
.chat-input:focus{border-color:rgba(99,102,241,0.4)}
.chat-send{background:linear-gradient(135deg,#6366f1,#818cf8);border:none;border-radius:10px;padding:10px 16px;color:#fff;font-weight:700;cursor:pointer;font-family:inherit;transition:all 0.2s}
.chat-send:hover{box-shadow:0 4px 15px rgba(99,102,241,0.4)}
.hud-top{position:fixed;top:12px;left:12px;z-index:15;display:flex;gap:10px;align-items:center}
.hud-pill{background:rgba(10,10,30,0.85);border:1px solid rgba(99,102,241,0.25);border-radius:20px;padding:8px 16px;font-size:0.85rem;font-weight:600;backdrop-filter:blur(6px)}
.hud-pill .emoji{margin-right:6px}
.crosshair{position:fixed;top:50%;left:calc(50% - 160px);transform:translate(-50%,-50%);width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,0.3);z-index:12;pointer-events:none}
.splash{position:fixed;inset:0;z-index:200;background:radial-gradient(ellipse at 50% 40%,#101040,#050510);display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:20px}
.splash h1{font-size:clamp(2rem,5vw,3.5rem);background:linear-gradient(135deg,#6366f1,#818cf8,#a5b4fc);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}
.splash .room-icon{font-size:5rem;margin-bottom:20px}
.splash p{color:rgba(255,255,255,0.6);max-width:450px;margin-bottom:28px;line-height:1.7}
.splash .start-btn{padding:16px 48px;background:linear-gradient(135deg,#6366f1,#4f46e5);border:none;border-radius:14px;color:#fff;font-size:1.1rem;font-weight:800;cursor:pointer;font-family:inherit;transition:all 0.3s;box-shadow:0 4px 30px rgba(99,102,241,0.4)}
.splash .start-btn:hover{transform:translateY(-3px);box-shadow:0 8px 40px rgba(99,102,241,0.6)}
.splash .controls{margin-top:24px;font-size:0.8rem;color:rgba(255,255,255,0.3);line-height:1.8}
.splash .controls kbd{background:rgba(255,255,255,0.1);padding:2px 8px;border-radius:4px;font-family:'Courier New',monospace}
.back-link{position:fixed;top:12px;right:340px;z-index:20;color:rgba(255,255,255,0.5);text-decoration:none;font-size:0.85rem}
.back-link:hover{color:#fff}
.hidden{display:none!important}
@media(max-width:768px){.chat-panel{width:100%;height:40%;top:auto;border-left:none;border-top:1px solid rgba(99,102,241,0.2)}.crosshair{left:50%;top:30%}.back-link{right:12px;top:auto;bottom:calc(40% + 12px)}}
</style>
</head>
<body>
<div class="splash" id="splash">
  <div class="room-icon">üõèÔ∏è</div>
  <h1>The Bedroom</h1>
  <p>A chill late-night vibe. Neon accents, a cozy bed, gaming setup, and ambient mood lighting. Relax and chat with friends.</p>
  <button class="start-btn" onclick="enterRoom()">Enter Room</button>
  <div class="controls"><kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> Walk &nbsp;|&nbsp; <kbd>Mouse</kbd> Look &nbsp;|&nbsp; <kbd>T</kbd> Chat</div>
</div>
<a href="../games/index.html" class="back-link hidden" id="backLink">‚Üê Back to Hub</a>
<div class="hud-top hidden" id="hud"><div class="hud-pill"><span class="emoji">üõèÔ∏è</span> Bedroom</div></div>
<div class="crosshair hidden" id="crosshair"></div>
<div class="chat-panel hidden" id="chatPanel">
  <div class="chat-header"><h3>üí¨ Room Chat</h3><span class="room-count" id="userCount">3 online</span></div>
  <div class="chat-msgs" id="chatMsgs"></div>
  <div class="chat-input-wrap"><input type="text" class="chat-input" id="chatInput" placeholder="Type a message..." maxlength="200" autocomplete="off"><button class="chat-send" onclick="sendChat()">Send</button></div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
var scene,camera,renderer,clock;
var keys={},euler=new THREE.Euler(0,0,0,'YXZ'),isPointerLocked=false,gameStarted=false;
var npcs=[],chatHistory=[];

var NPC_DATA=[
  {name:'Jordan',color:'#f472b6',msgs:['this room is so chill','love the neon vibes','anyone gaming rn?','I need to redecorate my room like this','zzz...']},
  {name:'Casey',color:'#22d3ee',msgs:['yo whats up','check out that gaming setup','the mood lighting is perfect','late night crew represent','brb']},
];

function addSystemMsg(t){chatHistory.push({type:'system',text:t});renderChat()}
function addNpcMsg(n,c,t){chatHistory.push({type:'npc',name:n,color:c,text:t});renderChat()}
function addPlayerMsg(t){chatHistory.push({type:'player',name:'You',color:'#6366f1',text:t});renderChat()}
function renderChat(){var el=document.getElementById('chatMsgs'),html='';chatHistory.slice(-50).forEach(function(m){if(m.type==='system')html+='<div class="chat-msg system">'+m.text+'</div>';else html+='<div class="chat-msg"><div class="name" style="color:'+m.color+'">'+m.name+'</div>'+m.text+'</div>';});el.innerHTML=html;el.scrollTop=el.scrollHeight}
function sendChat(){var input=document.getElementById('chatInput'),text=input.value.trim();if(!text)return;addPlayerMsg(text);input.value='';setTimeout(function(){if(Math.random()>0.35){var npc=NPC_DATA[Math.floor(Math.random()*NPC_DATA.length)];var r=['haha nice','mood','fr fr','lol','üí§','same tbh','üëÄ','vibes'];addNpcMsg(npc.name,npc.color,r[Math.floor(Math.random()*r.length)])}},1500+Math.random()*3000)}

function init(){
  scene=new THREE.Scene();scene.background=new THREE.Color(0x06060e);
  camera=new THREE.PerspectiveCamera(70,(window.innerWidth-320)/window.innerHeight,0.1,100);
  camera.position.set(0,1.6,3);
  renderer=new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth-320,window.innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
  renderer.shadowMap.enabled=true;
  document.body.insertBefore(renderer.domElement,document.body.firstChild);
  clock=new THREE.Clock();

  // Lights ‚Äî moody bedroom
  scene.add(new THREE.AmbientLight(0x111128,0.4));
  var neon1=new THREE.PointLight(0x6366f1,0.8,10);neon1.position.set(-4,2.5,0);scene.add(neon1);
  var neon2=new THREE.PointLight(0xf472b6,0.6,10);neon2.position.set(4,2.5,-3);scene.add(neon2);
  var desk=new THREE.PointLight(0x22d3ee,0.5,6);desk.position.set(4,1.2,2);scene.add(desk);
  var ceil=new THREE.PointLight(0x333355,0.3,12);ceil.position.set(0,2.8,0);scene.add(ceil);

  buildRoom();createNPCs();

  window.addEventListener('resize',function(){var w=window.innerWidth>768?window.innerWidth-320:window.innerWidth;var h=window.innerWidth>768?window.innerHeight:window.innerHeight*0.6;camera.aspect=w/h;camera.updateProjectionMatrix();renderer.setSize(w,h)});
  document.addEventListener('keydown',function(e){keys[e.code]=true;if(e.code==='KeyT'&&gameStarted){e.preventDefault();document.exitPointerLock();document.getElementById('chatInput').focus()}if(e.code==='Enter'&&document.activeElement===document.getElementById('chatInput'))sendChat()});
  document.addEventListener('keyup',function(e){keys[e.code]=false});
  document.addEventListener('mousemove',function(e){if(!isPointerLocked)return;euler.y-=e.movementX*0.002;euler.x-=e.movementY*0.002;euler.x=Math.max(-1.2,Math.min(1.2,euler.x));camera.quaternion.setFromEuler(euler)});
  renderer.domElement.addEventListener('click',function(){if(gameStarted)renderer.domElement.requestPointerLock()});
  document.addEventListener('pointerlockchange',function(){isPointerLocked=(document.pointerLockElement===renderer.domElement)});
  renderer.render(scene,camera);
}

function addBox(w,h,d,color,x,y,z,emissive){
  var mat=new THREE.MeshStandardMaterial({color:color,roughness:0.85,metalness:0.05});
  if(emissive){mat.emissive=new THREE.Color(color);mat.emissiveIntensity=0.6}
  var mesh=new THREE.Mesh(new THREE.BoxGeometry(w,h,d),mat);
  mesh.position.set(x,y,z);mesh.castShadow=true;mesh.receiveShadow=true;
  scene.add(mesh);return mesh;
}

function buildRoom(){
  var room=10,h=3;
  // Floor ‚Äî dark wood
  var floor=new THREE.Mesh(new THREE.PlaneGeometry(room,room),new THREE.MeshStandardMaterial({color:0x1a1520,roughness:0.9}));
  floor.rotation.x=-Math.PI/2;floor.receiveShadow=true;scene.add(floor);
  // Ceiling
  var c=new THREE.Mesh(new THREE.PlaneGeometry(room,room),new THREE.MeshStandardMaterial({color:0x0e0e18,roughness:0.95}));
  c.rotation.x=Math.PI/2;c.position.y=h;scene.add(c);
  // Walls
  var wm=new THREE.MeshStandardMaterial({color:0x151525,roughness:0.9});
  var addWall=function(w2,ht,x,y,z,ry){var w=new THREE.Mesh(new THREE.PlaneGeometry(w2,ht),wm);w.position.set(x,y,z);w.rotation.y=ry||0;w.receiveShadow=true;scene.add(w)};
  addWall(room,h,0,h/2,-room/2,0);addWall(room,h,0,h/2,room/2,Math.PI);addWall(room,h,-room/2,h/2,0,Math.PI/2);addWall(room,h,room/2,h/2,0,-Math.PI/2);

  // Bed ‚Äî back left
  addBox(2.2,0.5,3,0x2a1a40,-3,0.25,-3);// mattress
  addBox(2.2,0.8,0.15,0x1a1230,-3,0.4,-4.42);// headboard
  addBox(2,0.15,2.6,0x352050,-3,0.52,-3);// duvet
  addBox(0.5,0.2,0.4,0x4a3070,-3.5,0.65,-4);// pillow
  addBox(0.5,0.2,0.4,0x4a3070,-2.5,0.65,-4);// pillow

  // Nightstand
  addBox(0.5,0.5,0.4,0x1a1230,-1.6,0.25,-4);
  // Lamp on nightstand (neon glow)
  addBox(0.12,0.35,0.12,0x333355,-1.6,0.6,-4);
  addBox(0.25,0.15,0.25,0x6366f1,-1.6,0.82,-4,true);

  // Gaming desk ‚Äî right wall
  addBox(2.5,0.06,0.8,0x1a1a2a,4,0.72,2);// desktop
  addBox(0.06,0.72,0.06,0x111120,3,0.36,1.7);// leg
  addBox(0.06,0.72,0.06,0x111120,5,0.36,1.7);// leg
  addBox(0.06,0.72,0.06,0x111120,3,0.36,2.3);// leg
  addBox(0.06,0.72,0.06,0x111120,5,0.36,2.3);// leg
  // Monitor
  addBox(1.2,0.7,0.05,0x111118,4,1.2,2.3);
  var screen=new THREE.Mesh(new THREE.PlaneGeometry(1.1,0.6),new THREE.MeshStandardMaterial({color:0x0a1525,emissive:0x22d3ee,emissiveIntensity:0.15}));
  screen.position.set(4,1.2,2.27);scene.add(screen);
  // Monitor stand
  addBox(0.06,0.15,0.3,0x111120,4,0.83,2.3);
  // Keyboard
  addBox(0.8,0.04,0.25,0x0a0a15,4,0.78,1.9);
  // Mouse
  addBox(0.15,0.04,0.1,0x0a0a15,4.7,0.78,1.9);
  // Chair
  addBox(0.6,0.08,0.6,0x1a1a2e,4,0.45,1);// seat
  addBox(0.6,0.7,0.08,0x1a1a2e,4,0.85,0.74);// back
  addBox(0.06,0.45,0.06,0x111120,3.75,0.22,0.75);
  addBox(0.06,0.45,0.06,0x111120,4.25,0.22,0.75);
  addBox(0.06,0.45,0.06,0x111120,3.75,0.22,1.25);
  addBox(0.06,0.45,0.06,0x111120,4.25,0.22,1.25);

  // RGB light strip on ceiling edge ‚Äî back wall (emissive)
  addBox(9.5,0.06,0.06,0x6366f1,0,2.97,-4.95,true);
  addBox(0.06,0.06,9.5,0xf472b6,-4.95,2.97,0,true);

  // Poster on wall
  addBox(1.2,1.6,0.02,0x1a2535,0,1.8,-4.95);
  var poster=new THREE.Mesh(new THREE.PlaneGeometry(1.1,1.5),new THREE.MeshStandardMaterial({color:0x203050,emissive:0x203050,emissiveIntensity:0.2}));
  poster.position.set(0,1.8,-4.93);scene.add(poster);

  // Rug
  var rug=new THREE.Mesh(new THREE.CircleGeometry(1.5,16),new THREE.MeshStandardMaterial({color:0x1a1535,roughness:0.95}));
  rug.rotation.x=-Math.PI/2;rug.position.set(0,0.01,0);scene.add(rug);

  // Closet ‚Äî left wall back
  addBox(1.5,2.5,0.6,0x151525,-4.5,1.25,-1);
  addBox(0.02,2.4,0.01,0x222240,-3.75,1.25,-0.7);// handle line
}

function createNPCs(){
  NPC_DATA.forEach(function(data,i){
    var color=new THREE.Color(data.color);
    var body=new THREE.Mesh(new THREE.CylinderGeometry(0.2,0.22,1,8),new THREE.MeshStandardMaterial({color:color}));
    var head=new THREE.Mesh(new THREE.SphereGeometry(0.18,8,8),new THREE.MeshStandardMaterial({color:0xdbb896}));
    head.position.y=0.7;body.add(head);
    var cv=document.createElement('canvas');cv.width=128;cv.height=32;var cx=cv.getContext('2d');cx.font='bold 18px sans-serif';cx.fillStyle=data.color;cx.textAlign='center';cx.fillText(data.name,64,22);
    var sp=new THREE.Sprite(new THREE.SpriteMaterial({map:new THREE.CanvasTexture(cv),transparent:true}));sp.position.y=1;sp.scale.set(1.2,0.3,1);body.add(sp);
    var pos=[new THREE.Vector3(-1,0.5,1),new THREE.Vector3(2,0.5,-1)];
    body.position.copy(pos[i]);scene.add(body);
    npcs.push({mesh:body,data:data,target:pos[i].clone(),timer:Math.random()*5,chatTimer:6+Math.random()*15,baseY:0.5});
  });
}

function enterRoom(){
  gameStarted=true;
  document.getElementById('splash').classList.add('hidden');
  ['hud','crosshair','chatPanel','backLink'].forEach(function(id){document.getElementById(id).classList.remove('hidden')});
  renderer.domElement.requestPointerLock();
  addSystemMsg('Welcome to the Bedroom üõèÔ∏è');
  addSystemMsg('Late night chill zone. Press T to chat.');
  NPC_DATA.forEach(function(d){addSystemMsg(d.name+' is here.')});
  animate();
}

function animate(){
  requestAnimationFrame(animate);
  var dt=Math.min(clock.getDelta(),0.05);
  if(isPointerLocked){
    var speed=3*dt;
    var fwd=new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion);fwd.y=0;fwd.normalize();
    var rt=new THREE.Vector3(1,0,0).applyQuaternion(camera.quaternion);rt.y=0;rt.normalize();
    var mv=new THREE.Vector3();
    if(keys['KeyW'])mv.add(fwd.clone().multiplyScalar(speed));
    if(keys['KeyS'])mv.add(fwd.clone().multiplyScalar(-speed));
    if(keys['KeyA'])mv.add(rt.clone().multiplyScalar(-speed));
    if(keys['KeyD'])mv.add(rt.clone().multiplyScalar(speed));
    camera.position.add(mv);
    camera.position.x=Math.max(-4.2,Math.min(4.2,camera.position.x));
    camera.position.z=Math.max(-4.2,Math.min(4.2,camera.position.z));
    camera.position.y=1.6;
  }
  npcs.forEach(function(npc){
    npc.timer-=dt;
    if(npc.timer<=0){npc.target.set(-2+Math.random()*4,npc.baseY,-2+Math.random()*4);npc.timer=3+Math.random()*5}
    var dir=npc.target.clone().sub(npc.mesh.position);
    if(dir.length()>0.2){dir.normalize().multiplyScalar(0.5*dt);dir.y=0;npc.mesh.position.add(dir);npc.mesh.rotation.y=Math.atan2(dir.x,dir.z)}
    npc.mesh.position.y=npc.baseY+Math.sin(Date.now()*0.003+npcs.indexOf(npc))*0.02;
    npc.chatTimer-=dt;
    if(npc.chatTimer<=0){addNpcMsg(npc.data.name,npc.data.color,npc.data.msgs[Math.floor(Math.random()*npc.data.msgs.length)]);npc.chatTimer=8+Math.random()*20}
  });
  // Neon pulse
  scene.children.forEach(function(c){if(c.isPointLight&&c.color.b>0.8){c.intensity=0.6+Math.sin(Date.now()*0.002)*0.2}});
  renderer.render(scene,camera);
}
init();
</script>
</body>
</html>